
---
module: ovirt_vmpool
short_description: Module to manage VM pools in oVirt/RHV
version_added: "2.3"
author: "Ondra Machacek (@machacekondra)"
description:
    - "Module to manage VM pools in oVirt/RHV."
options:
    id:
        description:
            - "ID of the vmpool to manage."
        version_added: "2.8"
    name:
        description:
            - "Name of the VM pool to manage."
        required: true
    comment:
        description:
            - Comment of the Virtual Machine pool.
    state:
        description:
            - "Should the VM pool be present/absent."
            - "Note that when C(state) is I(absent) all VMs in VM pool are stopped and removed."
        choices: ['present', 'absent']
        default: present
    template:
        description:
            - "Name of the template, which will be used to create VM pool."
    description:
        description:
            - "Description of the VM pool."
    cluster:
        description:
            - "Name of the cluster, where VM pool should be created."
    type:
        description:
            - "Type of the VM pool. Either manual or automatic."
            - "C(manual) - The administrator is responsible for explicitly returning the virtual machine to the pool.
               The virtual machine reverts to the original base image after the administrator returns it to the pool."
            - "C(Automatic) - When the virtual machine is shut down, it automatically reverts to its base image and
               is returned to the virtual machine pool."
            - "Default value is set by engine."
        choices: ['manual', 'automatic']
    vm_per_user:
        description:
            - "Maximum number of VMs a single user can attach to from this pool."
            - "Default value is set by engine."
    prestarted:
        description:
            - "Number of pre-started VMs defines the number of VMs in run state, that are waiting
               to be attached to Users."
            - "Default value is set by engine."
    vm_count:
        description:
            - "Number of VMs in the pool."
            - "Default value is set by engine."
    vm:
        description:
            - "For creating vm pool without editing template."
            - "Note: You can use C(vm) only for creating vm pool."
        type: dict
        suboptions:
            comment:
                description:
                    - Comment of the Virtual Machine.
            timezone:
                description:
                    - Sets time zone offset of the guest hardware clock.
                    - For example C(Etc/GMT)
            memory:
                description:
                    - Amount of memory of the Virtual Machine. Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB).
                    - Default value is set by engine.
            memory_guaranteed:
                description:
                    - Amount of minimal guaranteed memory of the Virtual Machine.
                      Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB).
                    - C(memory_guaranteed) parameter can't be lower than C(memory) parameter.
                    - Default value is set by engine.
            memory_max:
                description:
                    - Upper bound of virtual machine memory up to which memory hot-plug can be performed.
                      Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB).
                    - Default value is set by engine.
            cloud_init:
                description:
                    - Dictionary with values for Unix-like Virtual Machine initialization using cloud init.
                    - C(host_name) - Hostname to be set to Virtual Machine when deployed.
                    - C(timezone) - Timezone to be set to Virtual Machine when deployed.
                    - C(user_name) - Username to be used to set password to Virtual Machine when deployed.
                    - C(root_password) - Password to be set for user specified by C(user_name) parameter.
                    - C(authorized_ssh_keys) - Use this SSH keys to login to Virtual Machine.
                    - C(regenerate_ssh_keys) - If I(True) SSH keys will be regenerated on Virtual Machine.
                    - C(custom_script) - Cloud-init script which will be executed on Virtual Machine when deployed.  This is appended to the end of the
                      cloud-init script generated by any other options.
                    - C(dns_servers) - DNS servers to be configured on Virtual Machine.
                    - C(dns_search) - DNS search domains to be configured on Virtual Machine.
                    - C(nic_boot_protocol) - Set boot protocol of the network interface of Virtual Machine. Can be one of C(none), C(dhcp) or C(static).
                    - C(nic_ip_address) - If boot protocol is static, set this IP address to network interface of Virtual Machine.
                    - C(nic_netmask) - If boot protocol is static, set this netmask to network interface of Virtual Machine.
                    - C(nic_gateway) - If boot protocol is static, set this gateway to network interface of Virtual Machine.
                    - C(nic_name) - Set name to network interface of Virtual Machine.
                    - C(nic_on_boot) - If I(True) network interface will be set to start on boot.
            sso:
                description:
                    - "I(True) enable Single Sign On by Guest Agent, I(False) to disable it. By default is chosen by oVirt/RHV engine."
                type: bool
            smartcard_enabled:
                description:
                    - "If I(true), use smart card authentication."
                type: bool
            nics:
                description:
                    - List of NICs, which should be attached to Virtual Machine. NIC is described by following dictionary.
                    - C(name) - Name of the NIC.
                    - C(profile_name) - Profile name where NIC should be attached.
                    - C(interface) -  Type of the network interface. One of following I(virtio), I(e1000), I(rtl8139), default is I(virtio).
                    - C(mac_address) - Custom MAC address of the network interface, by default it's obtained from MAC pool.
                    - NOTE - This parameter is used only when C(state) is I(running) or I(present) and is able to only create NICs.
                    - To manage NICs of the VM in more depth please use M(ovirt_nics) module instead.
        version_added: "2.9"
extends_documentation_fragment: ovirt
